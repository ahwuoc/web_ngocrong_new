RewriteEngine On

# Bảo mật - Chặn truy cập các file/thư mục nhạy cảm
RewriteRule ^config/ - [F,L]
RewriteRule ^includes/ - [F,L]
RewriteRule ^admin/(?!index\.php|.*\.css|.*\.js) - [F,L]
# Cho phép tất cả file media trong assets
# RewriteRule ^assets/(?!.*\.(css|js|png|jpg|jpeg|gif|svg|ico|woff|woff2|ttf|eot|mp4|webm|ogg)).*$ - [F,L]

# Chặn truy cập trực tiếp file .php (trừ các file đặc biệt)
RewriteCond %{THE_REQUEST} \s/+([^?\s]*?)\.php[\s?] [NC]
RewriteCond %{REQUEST_FILENAME} -f
RewriteCond %{REQUEST_URI} !^/(login|register|logout|profile|admin|giftcode|napthe)/
RewriteRule ^(.*)\.php$ /$1? [R=301,L]

# Loại bỏ index.php khỏi URL
RewriteRule ^index/?$ / [R=301,L]

# Routes chính - Trang chủ
RewriteRule ^$ index.php [L]

# Routes - Đăng nhập/Đăng ký/Đăng xuất/Profile
RewriteRule ^login/?$ login.php [L]
RewriteRule ^register/?$ register.php [L] 
RewriteRule ^logout/?$ logout.php [L]
RewriteRule ^profile/?$ profile.php [L]
RewriteRule ^bangxephang/?$ bangxephang.php [L]
RewriteRule ^bxh/?$ bangxephang.php [L]
RewriteRule ^giftcode/?$ giftcode.php [L]
RewriteRule ^napthe/?$ napthe.php [L]
RewriteRule ^napthe/?$ napthe.php [L]

# Routes - Admin (cho phép truy cập)
RewriteRule ^admin/?$ admin/index.php [L]
RewriteRule ^admin/(.+)$ admin/$1 [L]

# Routes - Danh mục (category)
RewriteRule ^category/([a-zA-Z0-9\-]+)/?$ category.php?slug=$1 [L]
RewriteRule ^category/([a-zA-Z0-9\-]+)/page/([0-9]+)/?$ category.php?slug=$1&page=$2 [L]

# Routes - Bài viết (post)
RewriteRule ^post/([a-zA-Z0-9\-]+)/?$ post.php?slug=$1 [L]

# Routes - Danh mục rút gọn (dựa theo slug thực tế)
RewriteRule ^tin-tuc/?$ category.php?slug=tin-tuc [L]
RewriteRule ^tin-tuc/page/([0-9]+)/?$ category.php?slug=tin-tuc&page=$1 [L]
RewriteRule ^su-kien/?$ category.php?slug=su-kien [L]
RewriteRule ^su-kien/page/([0-9]+)/?$ category.php?slug=su-kien&page=$1 [L]
RewriteRule ^huong-dan/?$ category.php?slug=huong-dan [L]
RewriteRule ^huong-dan/page/([0-9]+)/?$ category.php?slug=huong-dan&page=$1 [L]

# Chặn truy cập file .htaccess
<Files ".htaccess">
Order allow,deny
Deny from all
</Files>

# Chặn truy cập file config và database
<Files "*.sql">
Order allow,deny
Deny from all
</Files>

<Files "database.php">
Order allow,deny
Deny from all
</Files>

# Gzip compression
<IfModule mod_deflate.c>
AddOutputFilterByType DEFLATE text/html text/css text/javascript application/javascript application/json
</IfModule>

# Cache headers
<IfModule mod_expires.c>
ExpiresActive On
ExpiresByType text/css "access plus 1 month"
ExpiresByType application/javascript "access plus 1 month"
ExpiresByType image/png "access plus 1 month"
ExpiresByType image/jpg "access plus 1 month"
ExpiresByType image/jpeg "access plus 1 month"
ExpiresByType image/gif "access plus 1 month"
ExpiresByType image/svg+xml "access plus 1 month"
ExpiresByType video/mp4 "access plus 1 month"
ExpiresByType video/webm "access plus 1 month"
ExpiresByType video/ogg "access plus 1 month"
</IfModule>

# Chặn các method HTTP không cần thiết (bỏ comment để kiểm tra)
# <RequireAll>
# Require method GET POST
# </RequireAll>

# Chặn truy cập từ user agent xấu (bỏ comment để kiểm tra)
# RewriteCond %{HTTP_USER_AGENT} ^$ [OR]
# RewriteCond %{HTTP_USER_AGENT} (bot|crawler|spider) [NC]
# RewriteRule .* - [F,L]

# Error pages
ErrorDocument 404 /404.html
ErrorDocument 403 /403.html
ErrorDocument 500 /500.html
